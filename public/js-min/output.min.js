function parseTime(e){const t=new Date(e);return`${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}.${t.getMilliseconds().toString().padStart(3,"0")}`}function updateLeaderboards(){updateLeaderboard("leaderboard1",leaderboard1),updateLeaderboard("leaderboard2",leaderboard2)}function openSocket(){if(offline)return;const e="https:"===window.location.protocol?"wss:":"ws:",t=window.location.host;return(websocket=new WebSocket(`${e}//${t}/ws`)).onopen=e=>{console.log("CONNECTED"),document.getElementById("loading").style.display="none",websocket.send("REPORT-ROLE:Output"),fails=0},websocket.onmessage=socketOnMessage,websocket.onclose=e=>{if(console.log("DISCONNECTED"),fails>=MAX_TRIES)return offline=!0,document.getElementById("loading-inner").innerHTML="Offline mode",void setTimeout(()=>document.getElementById("loading").style.display="none",3e3);fails++,document.getElementById("loading-inner").innerHTML=`Disconnected.<br><br>Reconnecting ... ${fails}/${MAX_TRIES}`,document.getElementById("loading").style.display="block",setTimeout(openSocket,3e3)},websocket.onerror=e=>{console.log(`ERROR: ${e.data}`)},websocket}function startDots(){stopDots(),dotsInterval=setInterval(()=>{const e=document.getElementById("dots");e.innerText=".".repeat(e.innerText.length%3+1)},400)}function stopDots(){clearInterval(dotsInterval),document.getElementById("dots").innerText=""}function socketOnMessage(e){if(console.log(`RECEIVED: ${e.data}`),e.data.startsWith("@")){if(e.data.startsWith("@meta:")){const t=JSON.parse(e.data.slice(6));theme=t.theme}return}if(e.data.startsWith("!"))return void handleCommand(e.data);if(e.data.startsWith("AUTH:"))return;const t=JSON.parse(e.data);leaderboard1=t[0],leaderboard2=t[1],updateLeaderboards()}function appendRegName(e,t){t!=e.length+1&&(document.getElementById("banner-name").innerText=e.slice(0,t),setTimeout(()=>appendRegName(e,t+1)," "==e[t]?0:200))}function toggleDisplay(e){e.classList.contains("hidden")?e.classList.remove("hidden"):e.classList.add("hidden")}function handleCommand(e){if("!reload-all"==e)window.location.reload();else if("!disconnect-all-output"==e)websocket.close();else if("!fullscreen-all-output"==e)document.body.requestFullscreen();else if(e.startsWith("!adjust-height-")){const t=parseInt(e.slice(15));height=t+(height-baseHeight),baseHeight=t,shiftPages()}else if("!toggle-l4"==e)toggleDisplay(document.getElementById("leaderboard1"));else if("!toggle-l5"==e)toggleDisplay(document.getElementById("leaderboard2"));else if(e.startsWith("!announcement-show:")){const t=e.slice(19);document.getElementById("announcement").innerText=t,document.getElementById("announcement").classList.remove("hidden")}else if("!announcement-hide"==e)document.getElementById("announcement").classList.add("hidden"),document.getElementById("announcement").innerText="";else if(e.startsWith("!reginit-")){const t=e[9],n=e.slice(10);document.getElementById("banner-name").innerText="",document.getElementById("banner-ndisks").innerText=t,clearInterval(regInterval),document.getElementById("banner-time").innerText="Waiting to start ",document.getElementById("banner-time").style.color="white",document.getElementById("banner").style.display="flex",startDots(),document.getElementById("banner").animate([{left:CSS.percent(-200),bottom:CSS.percent(40)},{left:0,bottom:CSS.percent(40)}],{duration:600,fill:"forwards"}),setTimeout(()=>appendRegName(n,0),500),document.getElementById("overlay").style.display="block"}else if(e.startsWith("!regstart"))regStart=Date.now(),regInterval=setInterval(()=>{document.getElementById("banner-time").innerText=parseTime(Date.now()-regStart)},57),stopDots(),timeoutToClean=setTimeout(()=>{document.getElementById("banner").animate([{bottom:CSS.percent(40)},{bottom:0}],{duration:400,fill:"forwards"}),document.getElementById("overlay").style.display="none"},1e3),height=baseHeight-1;else if(e.startsWith("!regend-")){clearInterval(regInterval);const t=parseInt(e.slice(8));document.getElementById("banner-time").innerText=parseTime(t),document.getElementById("banner-time").style.color="lime",document.getElementById("banner").animate([{bottom:0},{bottom:CSS.percent(40)}],{duration:400,fill:"forwards"}),document.getElementById("overlay").style.display="block"}else"!regconfirm"==e?(document.getElementById("banner").animate([{left:0,bottom:CSS.percent(40)},{left:CSS.percent(-200),bottom:CSS.percent(40)}],{duration:600,fill:"forwards"}),setTimeout(()=>{document.getElementById("overlay").style.display="none",document.getElementById("banner").style.display="none"},600),height=baseHeight):"!regcancel"==e&&(document.getElementById("overlay").style.display="none",document.getElementById("banner").style.display="none",stopDots(),clearTimeout(timeoutToClean),clearInterval(regInterval),height=baseHeight)}function renderRecord(e,t,n,o){const a=document.createElement("div");a.classList.add("record");const l=document.createElement("span");l.classList.add("record-rank"),l.innerHTML=t<=3?["&#129351;","&#129352;","&#129353;"][t-1]:t.toString();const d=document.createElement("span");d.classList.add("record-name"),d.innerText=n;const r=document.createElement("span");if(r.classList.add("record-time"),r.innerText=parseTime(o),a.appendChild(l),"demonslayer"==theme){const e=document.createElement("div");e.classList.add("record-avatar");const t=document.createElement("img");t.src="/assets/tan.png",e.appendChild(t),a.appendChild(e)}a.appendChild(d),a.appendChild(r),e.appendChild(a)}function updateLeaderboard(e,t){const n=document.getElementById(e);if(n.innerHTML=`<h2 class="header">${id2titles[e]}</h2>`,0==t.length)n.innerHTML+="<h2>Waiting for challengers ...</h2>";else for(var o=1;o<=Math.min(3,t.length);o++){const{name:e,score:a}=t[o-1];renderRecord(n,o,e,a)}n.style.backgroundColor="lightgreen",loadPages(),setTimeout(()=>n.style.backgroundColor="",300)}function loadPage(e,t,n){for(;t.childElementCount>4;)t.removeChild(t.lastChild);for(var o=n*height+3;o<Math.min((n+1)*height+3,e.length);o++){const{name:n,score:a}=e[o];renderRecord(t,o+1,n,a)}}function loadPages(){loadPage(leaderboard1,document.getElementById("leaderboard1"),currentPages[0]),loadPage(leaderboard2,document.getElementById("leaderboard2"),currentPages[1])}function shiftPages(){const e=[leaderboard1,leaderboard2].map(e=>Math.ceil((e.length-3)/height));currentPages=currentPages.map((t,n)=>(t+1)%e[n]),loadPages()}function rand(e){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()[]{}|;:,./<>?`~-=_+ ";let o=0;for(;o<e;)t+=n.charAt(Math.floor(92*Math.random())),o+=1;return t}function titleAnim2(e){-1!=e&&(document.getElementById("title").innerText=title.slice(0,24-e)+document.getElementById("title").innerText.slice(24-e),setTimeout(()=>titleAnim2(e-1),30))}function titleAnim(e){24!=e?(document.getElementById("title").innerText=rand(e),setTimeout(()=>titleAnim(e+1),30)):titleAnim2(e)}const queryString=window.location.search,urlParams=new URLSearchParams(queryString),old=null!==urlParams.get("old");var leaderboard1=[],leaderboard2=[],regStart=0,regInterval=0,websocket=openSocket(),fails=0;const MAX_TRIES=5;var offline=!1,theme="gojo";const id2titles={leaderboard1:"4 disks",leaderboard2:"5 disks"};var dotsInterval=0,timeoutToClean=null,baseHeight=7,height=baseHeight,currentPages=[0,0];setInterval(shiftPages,Math.max(5e3,900*height));const title="Tower of Hanoi Challenge";setInterval(()=>titleAnim(1),3e4),setInterval(()=>{document.getElementById("setup").style.display="none",document.body.style.cursor="none"},8e3),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("title").innerText=title,document.getElementById("setup-fullscreen").onclick=()=>{document.body.requestFullscreen(),document.getElementById("setup").style.display="none",document.body.style.cursor="none"}});